<?xml version="1.0"?>
<project xmlns:artifact="antlib:org.apache.maven.artifact.ant" name="GATE-MAVEN-DEPLOY" basedir=".">
    <path id="maven-ant-tasks.classpath" path="maven-ant-tasks-2.1.1.jar"/>
    <typedef resource="org/apache/maven/artifact/ant/antlib.xml" uri="antlib:org.apache.maven.artifact.ant" classpathref="maven-ant-tasks.classpath"/>
    <description>Ant build file that pushes GATE pieces to the snapshot repository.</description>
    <property name="top" location="../../.."/>
    <property name="build" location="build" />
    <loadfile property="gate.version" srcFile="${top}/build/version.txt"/>
    <property name="snapshots.repo.url" value="http://repo.gate.ac.uk/content/repositories/snapshots"/>
    <property name="deploy.username" value="-SET-ME-"/>
    <property name="deploy.password" value="-SET-ME-"/>

    <!-- snapshot release production. We push the complete set of artifacts.  -->
    <target name="clean">
        <delete dir="${build}"/>
    </target>

    <target name="init">
        <mkdir dir="${build}"/>
    </target>

    <target name="prepare.extra.jars" depends="init">
        <jar destfile="${build}/gate-core-javadoc.jar"
             basedir="${top}/doc/javadoc"
             excludes="internal/**" />
        <jar destfile="${build}/gate-core-sources.jar"
             basedir="${top}/src"/>
    </target>

    <target name="prepare.snapshot.pom" depends="init">
        <property name="gate.core.pom"
                  location="${build}/gate-core.${gate.version}.pom.xml" />
        <copy tofile="${gate.core.pom}"
              file="gate-core-SNAPSHOT.pom.template">
            <filterset>
                <filter token="gate.version" value="${gate.version}" />
            </filterset>
        </copy>
    </target>

    <target name="snapshot-release" depends="clean, prepare.extra.jars, prepare.snapshot.pom">
        <artifact:pom id="gate-core.pom" file="${gate.core.pom}"/>
        <artifact:deploy file="${top}/bin/gate.jar">
            <attach file="${build}/gate-core-javadoc.jar" classifier="javadoc"/>
            <attach file="${build}/gate-core-sources.jar" classifier="sources"/>
            <remoteRepository url="${snapshots.repo.url}">
                <authentication username="${deploy.username}" password="${deploy.password}"/>
            </remoteRepository>
            <pom refid="gate-core.pom"/>
        </artifact:deploy>
    </target>
</project>
