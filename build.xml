<!-- $Id$ -->
<project name="GATE" default="all" basedir=".">
    <description>
        GATE see http://gate.ac.uk
    </description>
  <!-- set global properties for this build -->
  
  <!-- Directories -->
  
  <!-- Sources -->
  <property name="srcDir" location="src"/>
  
  <!-- Files required by the build process -->
  <property name="buildDir" location="build"/>
  
  <!-- Output directory for the build process -->
  <property name="outputDir"  location="classes"/>

  <!-- Libraries directory for the build process -->
  <property name="libDir"  location="lib"/>
  
  <!-- Extensions directory for the build process -->
  <property name="extDir"  location="lib/ext"/>

  <!-- Documentation directory -->
  <property name="docDir"  location="doc"/>
	  
  
  <!-- Use the new 1.3+ compiler -->
  <property name="build.compiler"  value="modern"/>

	<!-- The libraries -->
  <fileset id="libs" dir="${libDir}">
    <include name="*.jar"/>
    <include name="*.zip"/>
  </fileset>

	<!-- The extensions -->
  <fileset id="exts" dir="${extDir}">
    <include name="*.jar"/>
  </fileset>
  
  
  <!-- tools.jar path -->
  <path id="tools.jar.path" location="bin/tools14.jar"/>
  
  <!-- The build CLASSPATH -->
  <path id="build.class.path">
		<fileset refid="libs"/>
    <fileset refid="exts"/>
  </path>
  
  <!-- The run CLASSPATH -->
  <path id="run.class.path">
    <pathelement location="${buildDir}/gate.jar"/>
    <path refid="tools.jar.path"/>
  </path>
  
  <!-- Prints out some information messages -->
  <echo level="info">
    This is the ANT build script for GATE (http://gate.ac.uk).
    Type &quot;ant help&quot; for details about the targets available
  </echo>
  
  <!-- Prints out details about the targets -->
  <target name="help">
    <echo level="info">
      This is the ANT build script for gate (http://gate.ac.uk).
      The following targets are available
        -compile: compiles all the .java files
        -resources: copies the resources to the output directory (${outputDir})
        -jar: creates the gate.jar archive
        -run: starts GATE
        -clean: cleans up the output from all previous builds
        -guk: compiles the GUK classes and builds the guk.jar archive
        -gukdemo: starts the GUK Editor (a.k.a. GATE Unicode Editor)
        -test: runs the GATE test suite
        
        -all (default target): compiles GUK and GATE classes and makes the gate.jar archive.
    </echo>
  </target>
  
	<!-- Copies resources to the output directory -->
  <target name="resources">
		<copy todir="${outputDir}/gate/resources"
		      includeEmptyDirs="true" >
			<fileset dir="${srcDir}/gate/resources"
							 excludes="**/CVS,**/CVS/**,**/.cvsignore" />
		</copy>
		<copy file="${buildDir}/build.txt" todir="${outputDir}/gate/resources"/>
		<copy file="${buildDir}/version.txt" todir="${outputDir}/gate/resources"/>
	</target>


	<!-- This target compiles the GUK classes which are required by the main  
       GATE compile task -->  
  <target name="guk">
    <javac classpathref="build.class.path"
           destdir="${outputDir}" 
           includes="guk/**" 
           srcdir="${srcDir}"/>
		<jar destfile="${libDir}/ext/guk.jar" 
         update="false"
         index="false">
      <fileset dir="${outputDir}"
               includes="guk/**"/>
    </jar>
		<jar destfile="${libDir}/ext/guk.jar" 
         update="true"
         index="true">
      <fileset dir="${srcDir}/guk/resources"
               excludes="**/CVS,**/CVS/**,**/.cvsignore"/>
    </jar>
  </target>

	<!-- This target compiles all the classes -->  
  <target name="compile"
          depends="guk"
          description="compile the source " >
    <!-- Compile the java code from ${srcDir} into ${buildDir} -->
    <javac srcdir="${srcDir}" 
		       destdir="${outputDir}"
           includes="gate/**"
					 classpathref="build.class.path"/>
  </target>

	
  <!-- Make gate.jar archive -->
	<target name="jar" depends="compile,resources">
		<jar destfile="${buildDir}/gate.jar" 
         update="false"
         index="true">
      <fileset dir="${outputDir}/"
               includes="gate/**"/>
      <zipgroupfileset refid="libs"/>
    </jar>
	</target>
  
  <!-- Everything! -->
	<target name="all" depends="jar">
	</target>
  
  <!-- Run the beast -->
  <target name="run">
    <java classname="gate.Main" 
          classpathref="run.class.path" 
          fork="true"
          spawn="false"
          maxmemory="200m">
       <jvmarg value="-Djava.ext.dirs=${extDir}"/>   
     </java>
  </target>
  
  <!-- Run the GUK editor -->
  <target name="gukdemo">
    <java classname="guk.Editor" 
          fork="true"
          spawn="false">
      <jvmarg value="-Djava.ext.dirs=${extDir}"/>
     </java>
  </target>
  
  <!-- Clear all build output -->
  <target name="clean">
    <delete includeemptydirs="true">
      <fileset dir="${outputDir}" excludes="**/CVS,**/CVS/**,**/.cvsignore"/>
    </delete>
  </target>
  
  <!-- Make documentation -->
  <target name="doc">
    <javadoc access="protected" 
              destdir="${docDir}/javadoc"
              classpathref="run.class.path"
              Extdirs="${extDir}"
              Encoding="UTF-8"
              Use="yes"
              Windowtitle="GATE JavaDoc"
              link="http://java.sun.com/j2se/1.4.2/docs/api/"
              docencoding="UTF-8"
              charset="UTF-8"
              source="1.4"
              breakiterator="true">
      <fileset dir="${srcDir}"/>        
    </javadoc>
  </target>
  
  <!-- Make documentation -->
  <target name="internaldoc">
    <javadoc access="private" 
              destdir="${docDir}/javadoc/internal"
              classpathref="run.class.path"
              Extdirs="${extDir}"
              Encoding="UTF-8"
              Use="yes"
              Windowtitle="GATE JavaDoc"
              link="http://java.sun.com/j2se/1.4.2/docs/api/"
              docencoding="UTF-8"
              charset="UTF-8"
              source="1.4"
              breakiterator="true">
      <fileset dir="${srcDir}"/>        
    </javadoc>
  </target>

  
  <target name="test" depends="jar">
    <junit fork="true" 
           showoutput="yes"
           printsummary="yes">
      <classpath refid="run.class.path"/>
      <sysproperty key="gate.config" value="${buildDir}/gate.xml"/>
      <jvmarg value="-Djava.ext.dirs=${extDir}"/>
      <formatter type="plain"
                 usefile="false"/>
      <test name="gate.TestGate"/>
    </junit>
  </target>
  
</project>
